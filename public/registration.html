<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | CoNSTruct 2025 Hackathon</title>
    <meta
      name="description"
      content="Register your team for the CoNSTruct 2025 Product × AI hackathon."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/ui-enhancements.css" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#0d1021" />
  </head>
  <body>
    <a class="skip-link" href="#top">Skip to content</a>
    <div class="particle-sparks" aria-hidden="true">
      <span style="left: 6%; bottom: -10%; animation-delay: 0s;"></span>
      <span style="left: 20%; bottom: -18%; animation-delay: -1.4s;"></span>
      <span style="left: 34%; bottom: -14%; animation-delay: -2.2s;"></span>
      <span style="left: 48%; bottom: -22%; animation-delay: -3s;"></span>
      <span style="left: 60%; bottom: -16%; animation-delay: -0.6s;"></span>
      <span style="left: 74%; bottom: -20%; animation-delay: -2.8s;"></span>
      <span style="left: 88%; bottom: -26%; animation-delay: -4s;"></span>
      <span style="left: 94%; bottom: -12%; animation-delay: -5s;"></span>
      <span style="left: 14%; bottom: -28%; animation-delay: -3.6s;"></span>
      <span style="left: 42%; bottom: -30%; animation-delay: -4.8s;"></span>
      <span style="left: 68%; bottom: -24%; animation-delay: -5.4s;"></span>
      <span style="left: 82%; bottom: -32%; animation-delay: -6.2s;"></span>
    </div>
    <header class="site-header">
      <div class="container navigation">
        <a class="brand" href="index.html">
          <span>Co<span class="nst-highlight">NST</span>ruct 2025</span>
        </a>
        <nav>
          <button class="nav-toggle" aria-label="Toggle navigation" aria-controls="primary-navigation" aria-expanded="false">
            <span></span>
          </button>
          <div class="nav-links" id="primary-navigation">
            <a href="index.html#about">About</a>
            <a href="index.html#timeline">Structure</a>
            <a href="index.html#guidelines">Guidelines</a>
            <a href="index.html#awards">Awards</a>
            <a href="index.html#partners">Partners</a>
            <!-- navigation cleaned up -->
          </div>
        </nav>
      </div>
    </header>

    <main>
      <section class="page-hero">
        <div class="container">
          <h1>Register for Co<span class="nst-highlight">NST</span>ruct 2025</h1>
          <p>
            Share your team roster and focus so we can set up Emergent workspaces, collaboration pods, and checkpoints ahead of the
            Build for Impact Product × AI Hackathon.
          </p>
        </div>
      </section>

      <section class="alt-bg">
        <div class="container">
          
          <div class="form-card">
            <form id="team-registration" novalidate>
              <div class="section-heading" style="margin-bottom: 36px;">
                <h2>Team Registration</h2>
                <p>Only the essentials: share your team roster so we can secure your spot.</p>
              </div>

              <div class="input-group">
                <label for="team-name">Team Name *</label>
                <input
                  id="team-name"
                  name="teamName"
                  type="text"
                  class="input-control"
                  data-required="true"
                  data-error="Please provide a team name."
                  placeholder="e.g., Product Mavericks"
                />
                <span class="error-message" aria-live="polite"></span>
              </div>

              <div class="input-group">
                <label for="team-size">Team Size *</label>
                <select
                  id="team-size"
                  name="teamSize"
                  class="input-control"
                  data-required="true"
                  data-error="Select how many people are on your team (including the leader)."
                >
                  <option value="1" selected>1 member (solo)</option>
                  <option value="2">2 members</option>
                  <option value="3">3 members</option>
                  <option value="4">4 members</option>
                  <option value="5">5 members</option>
                </select>
                <span class="error-message" aria-live="polite"></span>
              </div>

              <div class="form-fieldset" data-role="lead">
                <h3>Team Leader</h3>
                <div class="form-row">
                  <div class="input-group">
                    <label for="lead-name">Name *</label>
                    <input
                      id="lead-name"
                      name="leadName"
                      type="text"
                      class="input-control"
                      data-required="true"
                      data-error="Enter the full name of the team leader."
                      placeholder="Team leader name"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                  <div class="input-group">
                    <label for="lead-email">College Email ID *</label>
                    <input
                      id="lead-email"
                      name="leadEmail"
                      type="email"
                      class="input-control"
                      data-required="true"
                      data-pattern="email"
                      data-error="Enter a valid college email for the team leader."
                      placeholder="name@university.edu.in"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
                <div class="form-row">
                  <div class="input-group">
                    <label for="lead-gender">Gender *</label>
                    <select
                      id="lead-gender"
                      name="leadGender"
                      class="input-control"
                      data-required="true"
                      data-error="Select the gender of the team leader."
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
              </div>

              <div class="form-fieldset" data-member="1" data-required="true" hidden>
                <h3>Team Member #1</h3>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member1-name">Name *</label>
                    <input
                      id="member1-name"
                      name="member1Name"
                      type="text"
                      class="input-control"
                      data-required="true"
                      data-error="Enter this teammate's name."
                      placeholder="Teammate name"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                  <div class="input-group">
                    <label for="member1-email">College Email ID *</label>
                    <input
                      id="member1-email"
                      name="member1Email"
                      type="email"
                      class="input-control"
                      data-required="true"
                      data-pattern="email"
                      data-error="Enter a valid college email."
                      placeholder="name@university.edu.in"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member1-gender">Gender *</label>
                    <select
                      id="member1-gender"
                      name="member1Gender"
                      class="input-control"
                      data-required="true"
                      data-error="Select a gender option."
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
              </div>

              <div class="form-fieldset" data-member="2" data-required="true" hidden>
                <h3>Team Member #2</h3>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member2-name">Name *</label>
                    <input
                      id="member2-name"
                      name="member2Name"
                      type="text"
                      class="input-control"
                      data-required="true"
                      data-error="Enter this teammate's name."
                      placeholder="Teammate name"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                  <div class="input-group">
                    <label for="member2-email">College Email ID *</label>
                    <input
                      id="member2-email"
                      name="member2Email"
                      type="email"
                      class="input-control"
                      data-required="true"
                      data-pattern="email"
                      data-error="Enter a valid college email."
                      placeholder="name@university.edu.in"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member2-gender">Gender *</label>
                    <select
                      id="member2-gender"
                      name="member2Gender"
                      class="input-control"
                      data-required="true"
                      data-error="Select a gender option."
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
              </div>

              <div class="form-fieldset" data-member="3" data-required="false" hidden>
                <h3>Team Member #3</h3>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member3-name">Name</label>
                    <input
                      id="member3-name"
                      name="member3Name"
                      type="text"
                      class="input-control"
                      data-required="false"
                      placeholder="Teammate name"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                  <div class="input-group">
                    <label for="member3-email">College Email ID</label>
                    <input
                      id="member3-email"
                      name="member3Email"
                      type="email"
                      class="input-control"
                      data-required="false"
                      data-pattern="email-optional"
                      placeholder="name@university.edu.in"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member3-gender">Gender</label>
                    <select
                      id="member3-gender"
                      name="member3Gender"
                      class="input-control"
                      data-required="false"
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
              </div>

              <div class="form-fieldset" data-member="4" data-required="false" hidden>
                <h3>Team Member #4</h3>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member4-name">Name</label>
                    <input
                      id="member4-name"
                      name="member4Name"
                      type="text"
                      class="input-control"
                      data-required="false"
                      placeholder="Teammate name"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                  <div class="input-group">
                    <label for="member4-email">College Email ID</label>
                    <input
                      id="member4-email"
                      name="member4Email"
                      type="email"
                      class="input-control"
                      data-required="false"
                      data-pattern="email-optional"
                      placeholder="name@university.edu.in"
                    />
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
                <div class="form-row">
                  <div class="input-group">
                    <label for="member4-gender">Gender</label>
                    <select
                      id="member4-gender"
                      name="member4Gender"
                      class="input-control"
                      data-required="false"
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                    <span class="error-message" aria-live="polite"></span>
                  </div>
                </div>
              </div>

              <p class="muted">
                Submissions may include up to four additional teammates besides the team leader. Build the crew that works best for you.
              </p>

              <button type="submit" class="btn primary">Submit Your Team Roster</button>
              <p class="status-message" id="team-status" role="status"></p>
            </form>
          </div>
        </div>
      </section>
    </main>

    <div
      id="submission-modal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="submission-modal-title"
      tabindex="-1"
    >
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__card" role="document">
        <span class="modal__icon" aria-hidden="true">🎉</span>
        <h3 id="submission-modal-title">Team locked in</h3>
        <p id="submission-modal-message" class="modal__message"></p>
        <button type="button" class="btn modal__close" data-close-modal>Great!</button>
      </div>
    </div>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-brand">
            <a class="brand" href="index.html">
              <picture>
                <source srcset="assets/logos/nst-logo.png" type="image/png" />
                <img src="assets/logos/nst-logo.png" alt="Newton School of Technology logo" />
              </picture>
              <span>Co<span class="nst-highlight">NST</span>ruct 2025</span>
            </a>
            <p>
              Let’s co-create products that matter — powered by Newton School of Technology × The Product Folks × Emergent.
            </p>
          </div>
          <div class="footer-links">
            <strong>Need Help?</strong>
            <a href="mailto:hackathon@nstproductx.ai">hackathon@nstproductx.ai</a>
            <a href="https://discord.com" target="_blank" rel="noreferrer noopener">Join our Discord</a>
          </div>
          
        </div>
        <div class="footer-bottom">
          <span>© 2025 CoNSTruct Hackathon</span>
          <span>Newton School of Technology × The Product Folks × Emergent</span>
        </div>
      </div>
    </footer>

    <script type="module">
      const initializeFirebase = async () => {
        try {
          const registrationModule = await import('./assets/js/register.js');
          if (registrationModule && typeof registrationModule.initFirebase === 'function') {
            registrationModule.initFirebase();
          }
        } catch (error) {
          console.warn('Firebase initialization skipped; continuing without remote persistence.', error);
        }
      };

      const navToggle = document.querySelector(".nav-toggle");
      const navLinks = document.getElementById("primary-navigation");

      if (navToggle && navLinks) {
        const setNavState = (isOpen) => {
          navLinks.classList.toggle("is-open", isOpen);
          navToggle.classList.toggle("is-active", isOpen);
          document.body.classList.toggle("nav-open", isOpen);
          navToggle.setAttribute("aria-expanded", String(isOpen));
        };

        navToggle.addEventListener("click", () => {
          const isOpen = !navLinks.classList.contains("is-open");
          setNavState(isOpen);
        });

        navLinks.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", () => setNavState(false));
        });

        navLinks.addEventListener("click", (event) => {
          if (event.target === navLinks) {
            setNavState(false);
          }
        });

        window.addEventListener("keydown", (event) => {
          if (event.key === "Escape" && navLinks.classList.contains("is-open")) {
            setNavState(false);
            navToggle.focus();
          }
        });

        window.addEventListener("resize", () => {
          if (window.innerWidth > 820 && navLinks.classList.contains("is-open")) {
            setNavState(false);
          }
        });
      }

      const emailPattern = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
      const API_ENDPOINT = '/api/registrations';

      initializeFirebase();

      const clearError = (field) => {
        if (!field) return;
        field.classList.remove("error");
        const errorContainer = field.parentElement.querySelector(".error-message");
        if (errorContainer) {
          errorContainer.textContent = "";
        }
      };

      const setError = (field, message) => {
        if (!field) return;
        field.classList.add("error");
        const errorContainer = field.parentElement.querySelector(".error-message");
        if (errorContainer) {
          errorContainer.textContent = message;
        }
      };

      const getFieldValue = (element) => {
        if (!element) {
          return "";
        }
        const value = typeof element.value === "string" ? element.value.trim() : "";
        return value;
      };

      const validateField = (field) => {
        const rawValue = typeof field.value === "string" ? field.value : "";
        const value = rawValue.trim();
        const isRequired = field.dataset.required === "true";
        const patternType = field.dataset.pattern;

        if (isRequired && value.length === 0) {
          setError(field, field.dataset.error || "This field is required.");
          return false;
        }

        if (value.length > 0) {
          if (patternType === "email" && !emailPattern.test(value)) {
            setError(field, field.dataset.error || "Enter a valid email address.");
            return false;
          }
          if (patternType === "email-optional" && !emailPattern.test(value)) {
            setError(field, field.dataset.error || "Enter a valid email address.");
            return false;
          }
        }

        clearError(field);
        return true;
      };

      const toggleFormLoading = (form, isLoading) => {
        const submitButton = form.querySelector('button[type="submit"], input[type="submit"]');
        if (submitButton) {
          submitButton.disabled = isLoading;
        }
      };

      const teamForm = document.getElementById("team-registration");
      const teamStatus = document.getElementById("team-status");
      const teamSizeField = document.getElementById("team-size");
      const leadGenderField = document.getElementById("lead-gender");
      const leadNameInput = document.getElementById("lead-name");
      const leadEmailInput = document.getElementById("lead-email");
      const submissionModal = document.getElementById('submission-modal');
      const submissionModalMessage = document.getElementById('submission-modal-message');
      const modalCloseElements = document.querySelectorAll('[data-close-modal]');

      const memberGroups = Array.from(document.querySelectorAll('[data-member]')).map((fieldset) => {
        const memberId = fieldset.dataset.member;
        return {
          fieldset,
          name: fieldset.querySelector(`#member${memberId}-name`),
          email: fieldset.querySelector(`#member${memberId}-email`),
          gender: fieldset.querySelector(`#member${memberId}-gender`),
        };
      });

      let activeMemberCount = 0;

      const toggleFieldRequirements = (group, required) => {
        if (!group) return;
        const requiredValue = required ? 'true' : 'false';
        if (group.name) {
          group.name.dataset.required = requiredValue;
          // Keep HTML5 required in sync for better UX and accessibility
          if (required) group.name.setAttribute('required', ''); else group.name.removeAttribute('required');
        }
        if (group.email) {
          group.email.dataset.required = requiredValue;
          group.email.dataset.pattern = required ? 'email' : 'email-optional';
          if (required) {
            group.email.setAttribute('required', '');
            // ensure input type email behaves with browser validation
            group.email.setAttribute('type', 'email');
          } else {
            group.email.removeAttribute('required');
            // allow optional emails to remain type=email but remove required
          }
        }
        if (group.gender) {
          group.gender.dataset.required = requiredValue;
          if (required) group.gender.setAttribute('required', ''); else group.gender.removeAttribute('required');
        }

        if (!required) {
          // Clear values when hiding so they won't be counted by payload
          if (group.name) {
            group.name.value = '';
            clearError(group.name);
          }
          if (group.email) {
            group.email.value = '';
            clearError(group.email);
          }
          if (group.gender) {
            group.gender.value = '';
            clearError(group.gender);
          }
        }
      };

      const setGroupVisibility = (group, isActive) => {
        if (!group || !group.fieldset) return;
        group.fieldset.dataset.active = String(isActive);
        if (isActive) {
          group.fieldset.removeAttribute('hidden');
          group.fieldset.style.display = '';
          group.fieldset.classList.remove('is-hidden');
        } else {
          group.fieldset.setAttribute('hidden', '');
          group.fieldset.style.display = 'none';
          group.fieldset.classList.add('is-hidden');
        }
      };

      const applyTeamSize = () => {
        if (!teamSizeField) {
          activeMemberCount = 0;
          return;
        }

        const rawValue = teamSizeField.value;
        console.debug('[Team Registration] team size selection changed:', rawValue || '(empty)');
        if (!rawValue) {
          activeMemberCount = 0;
          memberGroups.forEach((group) => {
            setGroupVisibility(group, false);
            toggleFieldRequirements(group, false);
          });
          console.debug('[Team Registration] cleared member fieldsets');
          return;
        }

        const selected = parseInt(rawValue, 10);
        let desired = Number.isNaN(selected) ? 0 : Math.max(selected - 1, 0);
        desired = Math.min(desired, memberGroups.length);
        activeMemberCount = desired;
        console.debug('[Team Registration] showing member slots:', desired);

        memberGroups.forEach((group, index) => {
          const isActive = index < desired;
          setGroupVisibility(group, isActive);
          toggleFieldRequirements(group, isActive);
        });
      };

      const ensureFemaleMember = () => {
        clearError(leadGenderField);
        memberGroups.forEach((group) => clearError(group.gender));
        return true;
      };

      const buildTeamPayload = () => {
        const selectedSize = teamSizeField ? parseInt(teamSizeField.value, 10) : activeMemberCount + 1;
        const teamSize = Number.isNaN(selectedSize) ? activeMemberCount + 1 : selectedSize;

        const members = memberGroups
          .map((group, index) => {
            const name = getFieldValue(group.name);
            const email = getFieldValue(group.email);
            const gender = getFieldValue(group.gender);
            const isActive = index < activeMemberCount;

            if (!isActive && !name && !email && !gender) {
              return null;
            }

            return {
              slot: index + 1,
              name: name || null,
              email: email || null,
              gender: gender || null,
            };
          })
          .filter(Boolean);

        return {
          teamName: getFieldValue(document.getElementById("team-name")),
          teamSize,
          lead: {
            name: getFieldValue(leadNameInput),
            email: getFieldValue(leadEmailInput),
            gender: getFieldValue(leadGenderField),
          },
          members,
        };
      };

      const handleFormSubmit = async (form, statusMessage, { extraValidation, getPayload, successMessage }) => {
        const fields = Array.from(form.querySelectorAll(".input-control"));
        const invalidFields = fields.filter((field) => !validateField(field));

        if (invalidFields.length > 0) {
          const firstInvalid = invalidFields[0];
          firstInvalid.focus();
          statusMessage.classList.remove('sr-only');
          statusMessage.classList.remove("success");
          statusMessage.classList.add("error");
          statusMessage.textContent = "Please resolve the highlighted fields before submitting.";
          return;
        }

        if (extraValidation && !extraValidation()) {
          statusMessage.classList.remove('sr-only');
          statusMessage.classList.remove("success");
          statusMessage.classList.add("error");
          statusMessage.textContent = "Please review your team details to satisfy the participation requirements.";
          return;
        }

        toggleFormLoading(form, true);
        statusMessage.classList.remove('sr-only');
        statusMessage.classList.remove("error", "success");
        statusMessage.textContent = "Submitting...";

        let payload = null;
        if (getPayload) {
          payload = getPayload();
        }

        if (!payload || !Array.isArray(payload.members) || payload.members.length !== (payload.teamSize - 1)) {
          statusMessage.classList.remove('sr-only');
          statusMessage.classList.remove('success');
          statusMessage.classList.add('error');
          statusMessage.textContent = 'Team size selection does not match member details.';
          toggleFormLoading(form, false);
          return;
        }

        try {
          const resp = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
          });

          if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            console.error('Server error', err);
            statusMessage.classList.remove('sr-only');
            statusMessage.classList.remove('success');
            statusMessage.classList.add('error');
            statusMessage.textContent = err && err.error ? err.error : 'Server failed to save your details.';
            toggleFormLoading(form, false);
            return;
          }
        } catch (error) {
          console.error('Network error', error);
          statusMessage.classList.remove('sr-only');
          statusMessage.classList.remove('success');
          statusMessage.classList.add('error');
          statusMessage.textContent = 'Network error while submitting — please try again.';
          toggleFormLoading(form, false);
          return;
        }

        const finalSuccessMessage =
          successMessage ||
          "Thanks for registering! We’ll reach out soon with next steps and prep material.";
        statusMessage.classList.remove("error");
        statusMessage.classList.add("success");
        statusMessage.textContent = finalSuccessMessage;
        statusMessage.classList.add('sr-only');
        showSubmissionModal(finalSuccessMessage);
        form.reset();
        if (teamSizeField) {
          teamSizeField.value = '';
          applyTeamSize();
        }
        toggleFormLoading(form, false);
      };

      document.querySelectorAll(".input-control").forEach((input) => {
        input.addEventListener("blur", () => validateField(input));

        if (input.tagName === "SELECT") {
          input.addEventListener("change", () => validateField(input));
        } else {
          input.addEventListener("input", () => {
            if (input.classList.contains("error")) {
              validateField(input);
            }
          });
        }
      });

      if (teamSizeField) {
        teamSizeField.addEventListener('change', applyTeamSize);
        teamSizeField.addEventListener('input', applyTeamSize);
        applyTeamSize();
      } else {
        activeMemberCount = 0;
      }

      if (teamForm) {
        teamForm.addEventListener("submit", async (event) => {
          event.preventDefault();
          await handleFormSubmit(teamForm, teamStatus, {
            extraValidation: ensureFemaleMember,
            getPayload: buildTeamPayload,
            successMessage:
              "Team locked in! Expect a welcome email with onboarding resources and Emergent workspace access shortly.",
          });
        });
      }

      const hideSubmissionModal = () => {
        if (!submissionModal) return;
        submissionModal.classList.remove('is-visible');
        submissionModal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');
      };

      const showSubmissionModal = (message) => {
        if (!submissionModal || !submissionModalMessage) return;
        submissionModalMessage.textContent = message;
        submissionModal.classList.add('is-visible');
        submissionModal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('modal-open');
        const focusTarget = submissionModal.querySelector('[data-close-modal]');
        if (focusTarget) {
          focusTarget.focus({ preventScroll: true });
        }
      };

      modalCloseElements.forEach((element) => {
        element.addEventListener('click', hideSubmissionModal);
      });

      if (submissionModal) {
        submissionModal.addEventListener('click', (event) => {
          if (event.target === submissionModal) {
            hideSubmissionModal();
          }
        });

        submissionModal.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            hideSubmissionModal();
          }
        });
      }
    </script>
    <script type="module" src="/assets/js/animations.js"></script>
    <script type="module" src="/assets/js/analytics.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js').catch((e) => console.warn('SW register failed', e));
        });
      }
    </script>
  </body>
</html>
